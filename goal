<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã‚¹ãƒãƒ›æ“ä½œã‚Œã‚“ã—ã‚…ã†ï¼šã‚´ãƒ¼ãƒ«ï¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --violet:#7b2fff;
      --ink:#222;
      --bg:#f6f7fb;
      --card:#fff;
      --link:#3178ff;
    }
    html,body{height:100%;margin:0}
    body{
      background: var(--bg);
      color: var(--ink);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Yu Gothic","Helvetica Neue",Arial,sans-serif;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; /* èŠ±ç«ã®å¤–ã¯éš ã™ */
    }
    .wrap{
      position:relative; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
    }
    canvas#fw{
      position:absolute; inset:0; width:100%; height:100%;
      touch-action:none; /* ç”»é¢ã‚¸ã‚§ã‚¹ãƒãƒ£ã‚’ã“ã“ã§å®Œçµ */
    }
    .card{
      position:relative; z-index:2; text-align:center;
      background:var(--card); padding:36px 28px; border-radius:16px;
      box-shadow:0 6px 24px rgba(0,0,0,.08);
      max-width:680px; margin:16px; box-sizing:border-box;
    }
    h1{font-size:2.2rem; margin:0 0 10px; color:var(--violet)}
    p{font-size:1.2rem; margin:8px 0}
    .btns{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:14px}
    .btn{
      font-size:1rem; font-weight:700; padding:10px 14px; border-radius:999px;
      border:0; cursor:pointer; background:#eef2ff; color:#1a2a6c;
    }
    a.btn{ text-decoration:none; display:inline-block }
    .hint{opacity:.7; font-size:.95rem; margin-top:6px}

    /* å‹•ãã‚’æ¸›ã‚‰ã™è¨­å®šã®äººã«ã¯ã‚¢ãƒ‹ãƒ¡ãªã— */
    @media (prefers-reduced-motion: reduce){
      canvas#fw{ display:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="fw" aria-hidden="true"></canvas>

    <div class="card" role="group" aria-label="ã‚´ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
      <h1>ğŸ‰ ã‚´ãƒ¼ãƒ«ï¼</h1>
      <p>ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
      <div class="btns">
        <a class="btn" href="./">æœ€åˆã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        <button id="replay" class="btn" type="button">ã‚‚ã†ä¸€åº¦ èŠ±ç«ã‚’ã‚ã’ã‚‹</button>
      </div>
      <p class="hint">ãƒ’ãƒ³ãƒˆï¼šç”»é¢ã®å¥½ããªå ´æ‰€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚‚èŠ±ç«ãŒä¸ŠãŒã‚Šã¾ã™ã€‚</p>
    </div>
  </div>

  <script>
  (()=>{
    const canvas = document.getElementById('fw');
    const ctx = canvas.getContext('2d', { alpha: true });
    let w = 0, h = 0, dpr = Math.max(1, window.devicePixelRatio || 1);
    let rafId = 0;
    const fireworks = [];
    const gravity = 0.06;     // ç²’å­ã®é‡åŠ›
    const drag    = 0.985;    // ç©ºæ°—æŠµæŠ—
    const burstMin = 70;      // ç²’å­æ•°ï¼ˆæœ€å°ï¼‰
    const burstMax = 110;     // ç²’å­æ•°ï¼ˆæœ€å¤§ï¼‰
    const hueBase = 260;      // ãƒ™ãƒ¼ã‚¹è‰²ç›¸ï¼ˆç´«ï¼‰
    let allowMotion = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function resize(){
      w = canvas.clientWidth * dpr;
      h = canvas.clientHeight * dpr;
      canvas.width = w; canvas.height = h;
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    resize();
    window.addEventListener('resize', resize);

    // ç²’å­ã‚¯ãƒ©ã‚¹
    class Particle{
      constructor(x,y,angle,speed,color,life){
        this.x = x; this.y = y;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.alpha = 1;
        this.life = life; // ãƒ•ãƒ¬ãƒ¼ãƒ æ•°
        this.color = color;
        this.size = 2 + Math.random()*2;
      }
      step(){
        this.life--;
        this.vx *= drag;
        this.vy *= drag;
        this.vy += gravity;
        this.x += this.vx;
        this.y += this.vy;
        this.alpha = Math.max(0, this.life / 60);
        return this.life > 0 && this.alpha > 0 && this.y < h + 10;
      }
      draw(ctx){
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    }

    // èŠ±ç«ï¼ˆæ‰“ã¡ä¸Šã’â†’çˆ†ç™ºï¼‰
    class Firework{
      constructor(x, y){
        this.x = x; this.y = h; // ç”»é¢ä¸‹ã‹ã‚‰æ‰“ã¡ä¸Šã’
        const t = (h - y) / h;  // æ‰“ã¡ä¸Šã’æ™‚é–“ã®ç›®å®‰
        this.vx = (Math.random()-0.5) * 2;
        this.vy = - (6 + 6*t);  // ç›®æ¨™é«˜ã•ã«å¿œã˜ã¦èª¿æ•´
        this.burstY = y + Math.random()*30 - 15; // ä»˜è¿‘ã§çˆ†ç™º
        this.stage = 'rise';
        this.particles = [];
        this.hue = hueBase + (Math.random()*60 - 30); // ç´«ä¸­å¿ƒÂ±
      }
      step(){
        if(this.stage === 'rise'){
          this.vy += gravity*0.5;
          this.x += this.vx;
          this.y += this.vy;
          // è»Œè·¡
          this.particles.push(new Particle(this.x, this.y, Math.random()*Math.PI*2, Math.random()*0.6, `hsla(${this.hue},100%,65%,0.6)`, 30));
          if (this.vy >= 0 || this.y <= this.burstY){
            this.stage = 'burst';
            this.explode();
          }
          // ä¸Šæ˜‡ç‚¹è‡ªä½“ã¯ç”Ÿå­˜ç¶™ç¶š
          return true;
        } else {
          // ç²’å­ç¾¤ã®æ›´æ–°
          this.particles = this.particles.filter(p => p.step());
          // å…¨æ»…ã§çµ‚äº†
          return this.particles.length > 0;
        }
      }
      explode(){
        const count = Math.floor(burstMin + Math.random()*(burstMax-burstMin));
        for (let i=0;i<count;i++){
          const angle = (i / count) * Math.PI*2 + Math.random()*0.05;
          const speed = 2 + Math.random()*3.5;
          const sat = 90 + Math.random()*10;
          const light = 55 + Math.random()*20;
          const life = 50 + Math.random()*30;
          const col = `hsl(${this.hue + (Math.random()*30-15)}, ${sat}%, ${light}%)`;
          this.particles.push(new Particle(this.x, this.y, angle, speed, col, life));
        }
      }
      draw(ctx){
        if(this.stage==='rise'){
          // æ‰“ã¡ä¸Šã’ç‚¹ï¼ˆå°ã•ãªå…‰ï¼‰
          ctx.globalAlpha = 1;
          ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
          ctx.beginPath();
          ctx.arc(this.x, this.y, 2.2, 0, Math.PI*2);
          ctx.fill();
        }
        // ç²’å­ã‚’æç”»
        this.particles.forEach(p => p.draw(ctx));
      }
    }

    // ãƒ«ãƒ¼ãƒ—
    function tick(){
      ctx.clearRect(0,0,w,h);
      // å°‘ã—æ®‹åƒã‚’æ®‹ã™ï¼ˆãµã‚“ã‚ã‚Šï¼‰
      ctx.globalCompositeOperation = 'lighter';

      for (let i=fireworks.length-1; i>=0; i--){
        const fw = fireworks[i];
        if (!fw.step()) fireworks.splice(i,1);
        else fw.draw(ctx);
      }

      ctx.globalCompositeOperation = 'source-over';
      rafId = requestAnimationFrame(tick);
    }

    function launch(x, y){
      if (!allowMotion) return;
      fireworks.push(new Firework(x, y));
    }

    // åˆæœŸã®èŠ±ç«ï¼ˆ3ç™ºï¼‰
    function intro(){
      const cx = canvas.clientWidth/2;
      const cy = canvas.clientHeight/2;
      launch(cx-80, cy-60);
      launch(cx+30, cy-40);
      launch(cx+90, cy-90);
    }

    // å…¥åŠ›ï¼šã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã§ä»»æ„ã®ä½ç½®ã«èŠ±ç«
    function clientXY(ev){
      if ('touches' in ev && ev.touches.length){
        return { x: ev.touches[0].clientX, y: ev.touches[0].clientY };
      } else if ('changedTouches' in ev && ev.changedTouches.length){
        return { x: ev.changedTouches[0].clientX, y: ev.changedTouches[0].clientY };
      } else {
        return { x: ev.clientX, y: ev.clientY };
      }
    }
    function onTap(ev){
      const p = clientXY(ev);
      launch(p.x * dpr, p.y * dpr);
    }

    // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    if (allowMotion){
      tick();
      intro();
    }else{
      // å‹•ãã‚’æ¸›ã‚‰ã™è¨­å®šã®ã¨ãã¯ã‚­ãƒ£ãƒ³ãƒã‚¹éè¡¨ç¤ºï¼ˆCSSï¼‰ï¼‹é™çš„è¡¨ç¤ºã®ã¿
    }

    canvas.addEventListener('pointerdown', onTap, { passive:true });
    canvas.addEventListener('touchstart', onTap, { passive:true });

    // ãƒªãƒ—ãƒ¬ã‚¤
    document.getElementById('replay').addEventListener('click', ()=>{
      if (!allowMotion) return;
      // ç”»é¢ä¸­å¤®ã€œä¸Šã«é€£ç¶šç™ºå°„
      const cx = canvas.clientWidth/2, top = canvas.clientHeight*0.35;
      for (let i=0;i<4;i++){
        setTimeout(()=> launch(cx + (i-1.5)*60 * dpr, top * dpr), i*180);
      }
    });

    // ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆä»–ãƒšãƒ¼ã‚¸é·ç§»æ™‚ï¼‰
    window.addEventListener('pagehide', ()=> cancelAnimationFrame(rafId));
  })();
  </script>
</body>
</html>
