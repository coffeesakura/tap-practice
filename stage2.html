<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!-- ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ æŠ‘æ­¢ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ã‚¹ãƒãƒ›æ“ä½œã‚Œã‚“ã—ã‚…ã†ï¼šã‚¹ãƒ†ãƒ¼ã‚¸2ï¼ˆãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ï¼‰</title>
  <style>
    html,body{
      height:100%; margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", "Helvetica Neue", Arial, sans-serif;
      background:#f6f7fb; color:#222; font-size:24px;
      touch-action: manipulation; -webkit-tap-highlight-color:transparent;
    }
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{background:#fff;padding:28px;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:640px;width:100%}
    .title{font-size:2.0rem;font-weight:700;margin:0 0 12px}
    .desc{font-size:1.2rem;line-height:1.7;margin:0 0 16px}
    .nav{display:flex;gap:12px;margin:0 0 12px}
    .nav a{font-size:1rem;text-decoration:none;background:#eef2ff;padding:8px 12px;border-radius:999px}
    .arena{display:flex;justify-content:center;margin:16px 0}
    .tap-btn{
      width:260px;height:260px;border:none;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #63a8ff, #3178ff);
      box-shadow:0 10px 24px rgba(49,120,255,.35);
      color:#fff;font-size:1.6rem;font-weight:700;cursor:pointer;touch-action:none;
    }
    .status{font-size:1.3rem;font-weight:700;text-align:center;min-height:2em;margin:14px 0}
    .bar-wrap{background:#eef2ff;height:20px;border-radius:999px;overflow:hidden;margin-bottom:12px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#65d06e,#2fb44d);transition:width .2s ease}
    .row{display:flex;justify-content:space-between;font-size:1.1rem;margin-bottom:12px}
    .hint{font-size:1.2rem;background:#fffbea;border:2px solid #ffe58f;padding:12px;border-radius:12px}
    .clear{display:none;text-align:center;color:#1f7a2f;font-weight:700;font-size:1.5rem;margin-top:14px}
    .controls{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .controls button{font-size:1rem}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="nav">
        <a href="./">â† ã‚¹ãƒ†ãƒ¼ã‚¸1ï¼ˆã‚¿ãƒƒãƒ—ï¼‰</a>
      </div>
      <p class="title">ã‚¹ãƒ†ãƒ¼ã‚¸2ï¼šãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã®ã‚Œã‚“ã—ã‚…ã†</p>
      <p class="desc">å¤§ããªä¸¸ã‚’<strong>ãƒˆãƒ³ãƒƒã€ãƒˆãƒ³ãƒƒ</strong>ã¨ç´ æ—©ã2å›ã‚¿ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†ã€‚<br>2å›ã®é–“éš”ãŒçŸ­ã„ã¨æˆåŠŸã€é•·ã„ã¨ã‚„ã‚Šç›´ã—ã«ãªã‚Šã¾ã™ã€‚</p>

      <div class="arena">
        <button id="tapBtn" class="tap-btn" aria-label="ã“ã“ã‚’ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—">ã“ã“ã‚’ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—</button>
      </div>

      <div id="status" class="status">æº–å‚™OKã€‚ã¾ãšã¯1å›ç›®ã€ã¤ã¥ã‘ã¦2å›ç›®ï¼</div>
      <div class="bar-wrap"><div id="bar" class="bar"></div></div>
      <div class="row">
        <div>æˆåŠŸæ•°ï¼š<strong id="count">0</strong></div>
        <div>ã®ã“ã‚Šï¼š<strong id="left">5</strong></div>
      </div>

      <div id="hint" class="hint">ã‚³ãƒ„ï¼šãƒ†ãƒ³ãƒã‚ˆãã€Œãƒˆãƒ³ãƒƒã€ãƒˆãƒ³ãƒƒã€ã€‚<br>é•·æŠ¼ã—ã¯å¤±æ•—ã€1å›ã ã‘ã ã¨ã‚„ã‚Šç›´ã—ã§ã™ã€‚</div>
      <div id="clear" class="clear">ğŸ‰ ã‚¯ãƒªã‚¢ï¼ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã¯ãƒãƒƒãƒãƒªã§ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ï¼</div>

      <div class="controls">
        <button id="reset">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
  </div>

  <script>
    // --- iOS Safari ã‚ºãƒ¼ãƒ æŠ‘æ­¢ï¼ˆãƒ€ãƒ–ãƒ«/ãƒ”ãƒ³ãƒï¼‰ ---
    (function(){
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(e){
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
      }, { passive:false });
      document.addEventListener('gesturestart', function(e){ e.preventDefault(); }, { passive:false });
    })();

    (function(){
      const tapBtn  = document.getElementById('tapBtn');
      const status  = document.getElementById('status');
      const bar     = document.getElementById('bar');
      const clearEl = document.getElementById('clear');
      const resetEl = document.getElementById('reset');
      const countEl = document.getElementById('count');
      const leftEl  = document.getElementById('left');
      const hintEl  = document.getElementById('hint');

      const GOAL = 5;
      const DOUBLE_MS = 300;  // 2å›ã®é–“éš”ï¼ˆmsï¼‰ä»¥å†…ã§æˆåŠŸ
      const LONG_MS   = 550;  // é•·æŠ¼ã—åˆ¤å®šï¼ˆmsï¼‰

      let count = 0;
      let awaitingSecond = false;
      let firstTapTime = 0;
      let longPressTimer = null;
      let pointerDown = false;

      function updateUI(){
        countEl.textContent = count;
        leftEl.textContent  = Math.max(0, GOAL - count);
        bar.style.width     = Math.min(100, Math.round(count/GOAL*100)) + '%';
        if (count >= GOAL){
          clearEl.style.display = 'block';
          tapBtn.disabled = true;
          status.textContent = "ãŠè¦‹äº‹ï¼ãƒªã‚ºãƒ è‰¯ãã§ãã¦ã„ã¾ã™ã€‚";
          hintEl.textContent = "æ¬¡ã¯é•·æŠ¼ã—ã‚„ã‚¹ãƒ¯ã‚¤ãƒ—ã«ã‚‚æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚";
        }
      }
      function reset(){
        count=0; awaitingSecond=false; firstTapTime=0;
        tapBtn.disabled=false; status.textContent="æº–å‚™OKã€‚ã¾ãšã¯1å›ç›®ã€ã¤ã¥ã‘ã¦2å›ç›®ï¼";
        hintEl.textContent="ã‚³ãƒ„ï¼šãƒ†ãƒ³ãƒã‚ˆãã€Œãƒˆãƒ³ãƒƒã€ãƒˆãƒ³ãƒƒã€ã€‚é•·æŠ¼ã—ã¯å¤±æ•—ã€1å›ã ã‘ã ã¨ã‚„ã‚Šç›´ã—ã§ã™ã€‚";
        clearEl.style.display='none'; updateUI();
      }

      function onPointerDown(){
        pointerDown = true;
        clearTimeout(longPressTimer);
        longPressTimer = setTimeout(()=>{
          if (!pointerDown) return;
          // é•·æŠ¼ã—å¤±æ•—
          status.textContent = "é•·æŠ¼ã—ã«ãªã‚Šã¾ã—ãŸã€‚è»½ãã€ãƒˆãƒ³ãƒƒã€ãƒˆãƒ³ãƒƒã€ã¨ç´ æ—©ã2å›ï¼";
          awaitingSecond=false; // æµã‚Œã‚’ãƒªã‚»ãƒƒãƒˆ
        }, LONG_MS);
      }
      function onPointerUp(){
        pointerDown = false;
        clearTimeout(longPressTimer);

        const now = performance.now();
        if (!awaitingSecond){
          // 1å›ç›®
          awaitingSecond = true;
          firstTapTime = now;
          status.textContent = "ã„ã„ã­ï¼ãã®èª¿å­ã§ã€ã‚‚ã†ä¸€åº¦ã™ãã‚¿ãƒƒãƒ—ï¼";
          // æœŸé™å†…ã«2å›ç›®ãŒæ¥ãªã‘ã‚Œã°å¤±æ•—
          setTimeout(()=>{
            if (awaitingSecond && (performance.now() - firstTapTime) > DOUBLE_MS){
              awaitingSecond = false;
              status.textContent = "å°‘ã—ã‚†ã£ãã‚Šã§ã—ãŸã€‚ãƒ†ãƒ³ãƒã‚ˆãã€ãƒˆãƒ³ãƒƒã€ãƒˆãƒ³ãƒƒã€ã§ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
            }
          }, DOUBLE_MS + 20);
        } else {
          // 2å›ç›®
          const gap = now - firstTapTime;
          if (gap <= DOUBLE_MS){
            // æˆåŠŸ
            count++;
            status.textContent = "æˆåŠŸï¼ã¨ã¦ã‚‚è‰¯ã„ãƒ†ãƒ³ãƒã§ã™ã€‚";
            awaitingSecond = false;
            updateUI();
          } else {
            // é…ã™ã
            status.textContent = "å°‘ã—é–“ãŒç©ºãã¾ã—ãŸã€‚ã‚‚ã†å°‘ã—é€Ÿã2å›ã‚¿ãƒƒãƒ—ï¼";
            awaitingSecond = false;
          }
        }
      }

      if (window.PointerEvent){
        tapBtn.addEventListener('pointerdown', onPointerDown, { passive:true });
        tapBtn.addEventListener('pointerup',   onPointerUp,   { passive:true });
        tapBtn.addEventListener('pointercancel', ()=>{ pointerDown=false; clearTimeout(longPressTimer); awaitingSecond=false; });
      } else {
        tapBtn.addEventListener('touchstart', ()=>onPointerDown(), { passive:true });
        tapBtn.addEventListener('touchend',   ()=>onPointerUp(),   { passive:true });
      }

      resetEl.addEventListener('click', reset);
      reset();
    })();
  </script>
</body>
</html>
