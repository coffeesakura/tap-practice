<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ã‚¹ãƒãƒ›æ“ä½œã‚Œã‚“ã—ã‚…ã†ï¼šã‚¹ãƒ†ãƒ¼ã‚¸4ï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—ï¼‰</title>
  <style>
    :root{
      --btn-c1:#ff9aa2; /* èµ¤ç³»ï¼ˆæ˜ã‚‹ã„ï¼‰ */
      --btn-c2:#ff2d2d; /* èµ¤ç³»ï¼ˆæ¿ƒã„ï¼‰ */
      --btn-clear1:#7fffaf; /* ã‚¯ãƒªã‚¢å¾Œã‚°ãƒªãƒ¼ãƒ³æ¡ˆå†… */
      --btn-clear2:#28a745;
    }
    html,body{
      height:100%; margin:0;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Yu Gothic","Helvetica Neue",Arial,sans-serif;
      background:#f6f7fb; color:#222; font-size:24px;
      touch-action: manipulation; -webkit-tap-highlight-color:transparent;
    }
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{background:#fff;padding:28px;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:640px;width:100%}
    .nav{display:flex;gap:12px;margin:0 0 12px}
    .nav a{font-size:1rem;text-decoration:none;background:#eef2ff;padding:8px 12px;border-radius:999px}
    .title{font-size:2rem;font-weight:700;margin:0 0 12px}
    .desc{font-size:1.2rem;line-height:1.7;margin:0 0 16px}
    .arena{display:flex;justify-content:center;margin:16px 0}
    .tap-btn{
      width:260px;height:260px;border:none;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, var(--btn-c1), var(--btn-c2));
      box-shadow:0 10px 24px rgba(0,0,0,.25);
      color:#fff;font-size:1.6rem;font-weight:700;cursor:pointer;
      touch-action:none;
    }
    .status{font-size:1.3rem;font-weight:700;text-align:center;min-height:2em;margin:14px 0}
    .bar-wrap{background:#eef2ff;height:20px;border-radius:999px;overflow:hidden;margin-bottom:12px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#65d06e,#2fb44d);transition:width .2s ease}
    .row{display:flex;justify-content:space-between;font-size:1.1rem;margin-bottom:12px}
    .hint{font-size:1.2rem;background:#fffbea;border:2px solid #ffe58f;padding:12px;border-radius:12px}
    .clear{display:none;text-align:center;color:#1f7a2f;font-weight:700;font-size:1.5rem;margin-top:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="nav">
        <a href="./">â† ã‚¹ãƒ†ãƒ¼ã‚¸1</a>
        <a href="./stage2.html">â† ã‚¹ãƒ†ãƒ¼ã‚¸2</a>
        <a href="./stage3.html">â† ã‚¹ãƒ†ãƒ¼ã‚¸3</a>
      </div>
      <p class="title">ã‚¹ãƒ†ãƒ¼ã‚¸4ï¼šã‚¹ãƒ¯ã‚¤ãƒ—ã®ã‚Œã‚“ã—ã‚…ã†</p>
      <p class="desc">å¤§ããªä¸¸ã‚’<strong>ä¸Šä¸‹å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>æ–¹å‘ã¯è‡ªç”±ã§ã™ã€‚5å›æˆåŠŸã§ã‚¯ãƒªã‚¢ï¼</p>

      <div class="arena">
        <button id="tapBtn" class="tap-btn" aria-label="ã“ã“ã‚’ã‚¹ãƒ¯ã‚¤ãƒ—">ã“ã“ã‚’ã‚¹ãƒ¯ã‚¤ãƒ—</button>
      </div>

      <div id="status" class="status">æº–å‚™OKã€‚æŒ‡ã‚’æ»‘ã‚‰ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>
      <div class="bar-wrap"><div id="bar" class="bar"></div></div>
      <div class="row">
        <div>æˆåŠŸæ•°ï¼š<strong id="count">0</strong></div>
        <div>ã®ã“ã‚Šï¼š<strong id="left">5</strong></div>
      </div>

      <div id="hint" class="hint">ã‚³ãƒ„ï¼šä¸¸ã®ä¸­ã‚’æŠ¼ã—ãŸã¾ã¾ã€ä¸Šä¸‹å·¦å³ã«æŒ‡ã‚’å‹•ã‹ã™ã¨ã‚¹ãƒ¯ã‚¤ãƒ—ã§ã™ã€‚</div>
      <div id="clear" class="clear">ğŸ‰ ã‚¯ãƒªã‚¢ï¼ã‚¹ãƒ¯ã‚¤ãƒ—ã¯ãƒãƒƒãƒãƒªã§ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸é€²ã¿ã¾ã—ã‚‡ã†ã€‚</div>
    </div>
  </div>

  <script>
    (function(){
      const tapBtn=document.getElementById('tapBtn');
      const status=document.getElementById('status');
      const bar=document.getElementById('bar');
      const clearEl=document.getElementById('clear');
      const countEl=document.getElementById('count');
      const leftEl=document.getElementById('left');
      const hintEl=document.getElementById('hint');

      const GOAL=5;
      let count=0, cleared=false;
      let startX=0, startY=0, swiping=false;

      function updateUI(){
        countEl.textContent=count;
        leftEl.textContent=Math.max(0,GOAL-count);
        bar.style.width=Math.min(100,Math.round(count/GOAL*100))+'%';
        if(!cleared && count>=GOAL){
          cleared=true;
          tapBtn.textContent="æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ â–¶";
          tapBtn.style.background="radial-gradient(circle at 30% 30%, var(--btn-clear1), var(--btn-clear2))";
          status.textContent="ãŠè¦‹äº‹ï¼ã‚¹ãƒ¯ã‚¤ãƒ—ã¯ãƒãƒƒãƒãƒªã§ã™ã€‚";
          clearEl.style.display='block';
          hintEl.textContent="ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒ†ãƒ¼ã‚¸5ã¸é€²ã‚“ã§ã¿ã¾ã—ã‚‡ã†ï¼";
        }
      }

      function reset(){
        count=0; cleared=false;
        tapBtn.textContent="ã“ã“ã‚’ã‚¹ãƒ¯ã‚¤ãƒ—";
        tapBtn.style.background="radial-gradient(circle at 30% 30%, var(--btn-c1), var(--btn-c2))";
        status.textContent="æº–å‚™OKã€‚æŒ‡ã‚’æ»‘ã‚‰ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
        hintEl.textContent="ã‚³ãƒ„ï¼šä¸¸ã®ä¸­ã‚’æŠ¼ã—ãŸã¾ã¾ã€ä¸Šä¸‹å·¦å³ã«æŒ‡ã‚’å‹•ã‹ã™ã¨ã‚¹ãƒ¯ã‚¤ãƒ—ã§ã™ã€‚";
        clearEl.style.display='none';
        updateUI();
      }

      function onPointerDown(e){
        if(cleared){ window.location.href="./stage5.html"; return; }
        swiping=true;
        startX=e.clientX||e.touches[0].clientX;
        startY=e.clientY||e.touches[0].clientY;
      }

      function onPointerUp(e){
        if(cleared){ window.location.href="./stage5.html"; return; }
        if(!swiping) return;
        swiping=false;
        const endX=e.clientX|| (e.changedTouches?e.changedTouches[0].clientX:0);
        const endY=e.clientY|| (e.changedTouches?e.changedTouches[0].clientY:0);
        const dx=endX-startX;
        const dy=endY-startY;
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist>50){ // ã‚¹ãƒ¯ã‚¤ãƒ—æˆåŠŸé–¾å€¤
          count++;
          status.textContent="ã‚¹ãƒ¯ã‚¤ãƒ—æˆåŠŸï¼";
          updateUI();
        } else {
          status.textContent="ã‚‚ã†å°‘ã—å¤§ããæŒ‡ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
        }
      }

      if(window.PointerEvent){
        tapBtn.addEventListener('pointerdown',onPointerDown,{passive:true});
        tapBtn.addEventListener('pointerup',onPointerUp,{passive:true});
      } else {
        tapBtn.addEventListener('touchstart',onPointerDown,{passive:true});
        tapBtn.addEventListener('touchend',onPointerUp,{passive:true});
      }

      reset();
    })();
  </script>
</body>
</html>
